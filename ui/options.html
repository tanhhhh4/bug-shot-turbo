<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bug Shot Turbo - Settings</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="options.css">
</head>

<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo-wrapper">
          <img src="../assets/icons/icon48.png" alt="Logo" class="logo">
          <span class="brand-name">Bug Shot</span>
        </div>
      </div>

      <nav class="sidebar-nav">
        <button class="nav-tab active" data-section="tapd">
          <span class="nav-icon">🎯</span>
          <span class="nav-text">TAPD 配置</span>
        </button>
        <button class="nav-tab" data-section="templates">
          <span class="nav-icon">📝</span>
          <span class="nav-text">模板设置</span>
        </button>
        <button class="nav-tab" data-section="dropdowns">
          <span class="nav-icon">▼</span>
          <span class="nav-text">下拉配置</span>
        </button>
        <button class="nav-tab" data-section="menu">
          <span class="nav-icon">📑</span>
          <span class="nav-text">菜单匹配</span>
        </button>
        <button class="nav-tab" data-section="ai">
          <span class="nav-icon">✨</span>
          <span class="nav-text">AI 助手</span>
        </button>
        <button class="nav-tab" data-section="shortcuts">
          <span class="nav-icon">⌨️</span>
          <span class="nav-text">快捷键</span>
        </button>
        <button class="nav-tab" data-section="data">
          <span class="nav-icon">💾</span>
          <span class="nav-text">数据管理</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <span class="version-badge">v0.1.0</span>
      </div>
    </aside>

    <main class="main-content">
      <header class="top-bar">
        <h1 id="pageTitle">TAPD 配置</h1>
        <div class="actions">
          <button id="resetOptions" class="btn btn-ghost">重置</button>
          <button id="saveOptions" class="btn btn-primary">
            <span>保存更改</span>
          </button>
        </div>
      </header>

      <div class="content-scroll-area">
        <!-- TAPD Section -->
        <section class="option-section active" id="tapd-section">
          <div class="settings-card">
            <div class="card-header">
              <h2>项目连接</h2>
              <p>配置 TAPD 项目信息以启用自动提交。</p>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="tapdProjectIds">项目 ID 列表</label>
                <input type="text" id="tapdProjectIds" placeholder="例如: 47910877, 12345678" class="input-lg">
                <p class="help-text">可在 TAPD URL 中找到，如 https://www.tapd.cn/12345678/...</p>
              </div>
              <div class="form-group">
                <label for="tapdDomains">TAPD 域名</label>
                <input type="text" id="tapdDomains" value="tapd.cn, tapd.tencent.com" class="input-lg">
              </div>
            </div>
          </div>

          <div class="settings-card">
            <div class="card-header">
              <h2>高级选择器</h2>
              <p>自定义页面元素定位，通常无需修改。</p>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="titleSelector">标题输入框</label>
                <input type="text" id="titleSelector" placeholder="input[name='bug[title]']" class="code-input">
              </div>
              <div class="form-group">
                <label for="descIframeSelector">描述编辑器 Iframe</label>
                <input type="text" id="descIframeSelector" placeholder="iframe.ke-edit-iframe" class="code-input">
              </div>
              <div class="form-group">
                <label for="descBodySelector">描述内容区域</label>
                <input type="text" id="descBodySelector" placeholder="body.ke-content" class="code-input">
              </div>
            </div>
          </div>

          <div class="settings-card">
            <div class="card-header">
              <h2>标注面板下拉值</h2>
              <p>维护“处理人/迭代”候选项，标注完成时以下拉形式选择。</p>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="assigneeOptions">处理人候选（每行一个）</label>
                <textarea id="assigneeOptions" rows="6" class="input-area" placeholder="例如：
张三
李四
王五"></textarea>
              </div>
              <div class="form-group">
                <label for="iterationOptions">迭代候选（每行一个）</label>
                <textarea id="iterationOptions" rows="6" class="input-area" placeholder="例如：
2026Q1-迭代1
2026Q1-迭代2"></textarea>
              </div>
            </div>
          </div>
        </section>

        <!-- Templates Section -->
        <section class="option-section" id="templates-section">
          <div class="settings-card">
            <div class="card-header">
              <h2>缺陷模板</h2>
              <p>定义自动生成的标题和描述格式。</p>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label for="titleTemplate">标题模板</label>
                <input type="text" id="titleTemplate" class="input-lg" placeholder="${issue}（${pathLast1}）">
                <div class="tags-cloud">
                  <span class="tag-pill">${issue}</span>
                  <span class="tag-pill">${firstTag}</span>
                  <span class="tag-pill">${pathLast1}</span>
                  <span class="tag-pill">${timestamp}</span>
                </div>
              </div>

              <div class="form-group">
                <label for="descTemplate">描述模板</label>
                <textarea id="descTemplate" rows="12" class="input-area"></textarea>
                <div class="tags-cloud">
                  <span class="tag-pill">${pageURL}</span>
                  <span class="tag-pill">${timestamp}</span>
                  <span class="tag-pill">${issue}</span>
                  <span class="tag-pill">${aiDetail}</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Dropdowns Section -->
        <section class="option-section" id="dropdowns-section">
          <div class="settings-card">
            <div class="card-header with-action">
              <div>
                <h2>下拉自动填充</h2>
                <p>根据描述关键词自动选择下拉项。</p>
              </div>
              <button id="addDropdownBtn" class="btn btn-secondary">
                <span>+ 新增规则</span>
              </button>
            </div>
            <div class="card-body">
              <div id="dropdownList" class="rules-list"></div>
            </div>
          </div>
        </section>

        <!-- Menu Section -->
        <section class="option-section" id="menu-section">
          <div class="settings-card">
            <div class="card-header with-action">
              <div>
                <h2>菜单抓取</h2>
                <p>自动识别当前页面的二级菜单路径。</p>
              </div>
              <button id="addMenuRuleBtn" class="btn btn-secondary">
                <span>+ 新增规则</span>
              </button>
            </div>
            <div class="card-body">
              <div id="menuRulesList" class="rules-list"></div>
            </div>
          </div>
        </section>

        <!-- AI Section -->
        <section class="option-section" id="ai-section">
          <div class="settings-card">
            <div class="card-header">
              <h2>AI 增强</h2>
              <p>使用 LLM 进行更智能的字段匹配。</p>
            </div>
            <div class="card-body">
              <div class="form-group checkbox-row">
                <label class="switch">
                  <input type="checkbox" id="aiEnable">
                  <span class="slider round"></span>
                </label>
                <span class="label-text">启用 AI 匹配</span>
              </div>

              <div class="form-group">
                <label for="aiEndpoint">API Endpoint</label>
                <input type="text" id="aiEndpoint" placeholder="https://api.openai.com/v1/chat/completions">
              </div>

              <div class="form-group">
                <label for="aiKey">API Key</label>
                <input type="password" id="aiKey" placeholder="sk-...">
              </div>

              <div class="form-group two-col">
                <div>
                  <label for="aiModel">模型名称</label>
                  <input type="text" id="aiModel" placeholder="gpt-3.5-turbo">
                </div>
                <div>
                  <label for="aiTimeout">超时 (ms)</label>
                  <input type="number" id="aiTimeout" value="5000">
                </div>
              </div>

              <div class="form-actions">
                <button id="aiTestBtn" class="btn btn-secondary">测试连接</button>
                <span id="aiTestStatus" class="status-text"></span>
              </div>
            </div>
          </div>
        </section>

        <!-- Shortcuts Section -->
        <section class="option-section" id="shortcuts-section">
          <div class="settings-card">
            <div class="card-header">
              <h2>快捷键</h2>
            </div>
            <div class="card-body">
              <div class="shortcut-row">
                <span>开启/关闭标注工具</span>
                <kbd>Alt + S</kbd>
              </div>
              <p class="help-text mt-2">如需修改，请前往 chrome://extensions/shortcuts</p>
            </div>
          </div>
        </section>

        <!-- Data Section -->
        <section class="option-section" id="data-section">
          <div class="settings-card">
            <div class="card-header">
              <h2>数据管理</h2>
            </div>
            <div class="card-body">
              <div class="button-grid">
                <button id="exportData" class="btn btn-secondary">导出配置</button>
                <button id="importData" class="btn btn-secondary">导入配置</button>
                <button id="resetDefaults" class="btn btn-secondary">恢复默认</button>
                <button id="clearHistory" class="btn btn-danger-ghost">清除历史记录</button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <div id="saveStatus" class="toast"></div>
  <input type="file" id="fileInput" style="display: none;" accept=".json">

  <script src="options.js"></script>
</body>

</html>

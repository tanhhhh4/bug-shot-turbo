# 🎯 简化工作流程说明

## ✅ 更新完成！

已成功简化矩形标注工具的输入流程，移除了冗余的整体问题描述输入框。

---

## 🔄 新工作流程

### 1️⃣ 框选主截图区域
- 按 `Alt+S` 启动截图工具
- 拖动鼠标框选主截图区域
- 显示实时尺寸指示器

### 2️⃣ 标注问题位置（矩形工具）
- 点击工具栏的"矩形"按钮
- 在不同问题位置绘制多个矩形框
- **每个矩形框独立输入文字描述**
  - 例如：`姓名必填`
  - 例如：`邮箱格式错误`
  - 例如：`电话号码重复`

### 3️⃣ 完成标注
- 点击工具栏的"完成"按钮
- 选择问题标签（必选）
- ❌ **无需输入整体问题描述**（已移除此步骤）
- 点击"提交"

### 4️⃣ 自动跳转 TAPD
- 系统自动生成标题和详细说明
- 跳转到 TAPD 新建缺陷页面
- 自动填充表单

---

## 📝 TAPD 自动填充格式

### 标题格式
```
1、姓名必填 2、邮箱格式错误 3、电话号码重复（page）
```

**说明**：
- 自动使用所有矩形框的描述
- 按 `1、2、3、` 格式连接（空格分隔）
- 末尾添加页面路径 `（${pathLast1}）`

### 详细说明格式
```
【问题类型】表单校验

【详细说明】
1、姓名必填
2、邮箱格式错误
3、电话号码重复

【页面地址】https://example.com/register
【发现时间】2025-01-08 15:30:00
【附件截图】粘贴后见下方（Ctrl/Cmd+V）
```

**说明**：
- 矩形框描述按 `1、2、3、` 格式换行显示
- 保留问题类型、页面地址、时间戳等信息

---

## 🗑️ 移除的内容

### ❌ 整体问题描述输入框
**旧流程**（已废弃）：
```
┌─────────────────────────────────┐
│ 已标注问题：                    │
│ 1、姓名必填                      │
│ 2、邮箱格式错误                  │
│ 3、电话号码重复                  │
├─────────────────────────────────┤
│ 整体问题描述：                   │
│ [输入框] ← 用户需要手动输入      │  ❌ 已删除
└─────────────────────────────────┘
```

**新流程**：
```
┌─────────────────────────────────┐
│ 已标注问题：                    │
│ 1、姓名必填                      │
│ 2、邮箱格式错误                  │
│ 3、电话号码重复                  │
├─────────────────────────────────┤
│ 选择问题标签：                   │
│ [按钮失效] [表单校验] ...       │
└─────────────────────────────────┘
```

**优势**：
- ✅ 减少输入步骤
- ✅ 避免重复描述
- ✅ 自动生成标题和详细说明
- ✅ 工作流程更流畅

---

## 🔧 技术实现

### 修改文件 1: `annotator-rectangle-tool.js`

#### 删除的代码
```html
<!-- 已删除 -->
<div class="bst-final-input">
  <label>整体问题描述：</label>
  <input type="text"
         id="bst-final-issue-input"
         placeholder="请输入整体问题描述..."
         autofocus>
</div>
```

#### 新增的逻辑
```javascript
async submitBugData(panel) {
  if (!this.bugData.tag) {
    this.showToast('请选择问题标签', 'warning');
    return;
  }

  // 自动生成 issue：所有矩形框描述按 "1、2、3、" 格式
  this.bugData.issue = this.rectangles.map(r => `${r.order}、${r.text}`).join(' ');

  // ... 其他逻辑
}
```

**说明**：
- 移除了对 `#bst-final-issue-input` 的引用
- 移除了空值验证提示
- 自动生成 `issue` 字段（用于兼容旧逻辑）

---

### 修改文件 2: `tapd-filler.js`

#### 更新的模板
```javascript
templates: {
  // 旧模板（已弃用）
  // title: "${issue}（${pathLast1}）",

  // 新模板
  title: "${rectangleList}（${pathLast1}）",

  // 描述模板（移除了 ${issue}）
  description: "【问题类型】${firstTag}\n\n【详细说明】\n${rectangleList}\n\n【页面地址】${pageURL}\n【发现时间】${timestamp}\n【附件截图】粘贴后见下方（Ctrl/Cmd+V）"
}
```

#### `renderTemplate` 函数（无需修改）
```javascript
renderTemplate(template, data) {
  return template.replace(/\${(\w+)}/g, (match, key) => {
    // 处理矩形标注列表
    if (key === 'rectangleList') {
      if (data.rectangles && Array.isArray(data.rectangles) && data.rectangles.length > 0) {
        // 标题中用空格连接，描述中用换行连接
        return data.rectangles.map(r => `${r.order}、${r.text}`).join('\n');
      }
      return '（无详细标注）';
    }
    return data[key] || '';
  });
}
```

**注意**：
- `rectangleList` 在模板中会用 `\n` 换行
- 但在标题中，`\n` 会被浏览器自动转换为空格
- 所以标题最终显示为：`1、姓名必填 2、邮箱格式错误 3、电话号码重复（page）`

---

## 📊 数据结构

### bugData 对象
```javascript
{
  tag: "表单校验",                    // 用户选择的标签
  issue: "1、姓名必填 2、邮箱格式错误 3、电话号码重复",  // 自动生成
  rectangles: [
    { order: 1, text: "姓名必填", x: 100, y: 150, width: 200, height: 40 },
    { order: 2, text: "邮箱格式错误", x: 100, y: 200, width: 200, height: 40 },
    { order: 3, text: "电话号码重复", x: 100, y: 250, width: 200, height: 40 }
  ],
  pageURL: "https://example.com/register",
  timestamp: "2025-01-08 15:30:00",
  pathLast1: "register",
  screenshot: "data:image/png;base64..."
}
```

---

## 🎯 用户体验改进

### 旧流程的问题
1. ❌ 用户标注了多个矩形框，每个都有描述
2. ❌ 但还需要在最后输入"整体问题描述"
3. ❌ 整体描述往往是矩形描述的重复总结
4. ❌ 增加了额外的输入负担

### 新流程的优势
1. ✅ 用户只需为每个矩形框输入描述
2. ✅ 系统自动将这些描述组合成标题和详细说明
3. ✅ 减少重复劳动
4. ✅ 符合"一次输入，处处复用"的设计理念

---

## 🚀 如何测试

### 1. 重新加载扩展
```
chrome://extensions/ → 刷新 Bug Shot Turbo
```

### 2. 刷新测试页面
```
按 F5 刷新当前页面
```

### 3. 完整测试流程
```
1. 按 Alt+S 启动
2. 框选主截图区域
3. 点击"矩形"工具
4. 绘制 3 个矩形框，分别输入：
   - "姓名必填"
   - "邮箱格式错误"
   - "电话号码重复"
5. 点击"完成"
6. 选择标签"表单校验"
7. 点击"提交"（不再需要输入整体描述）
8. 跳转到 TAPD，检查自动填充的内容
```

### 4. 预期结果
**TAPD 标题**：
```
1、姓名必填 2、邮箱格式错误 3、电话号码重复（register）
```

**TAPD 详细说明**：
```
【问题类型】表单校验

【详细说明】
1、姓名必填
2、邮箱格式错误
3、电话号码重复

【页面地址】https://example.com/register
【发现时间】2025-01-08 15:30:00
【附件截图】粘贴后见下方（Ctrl/Cmd+V）
```

---

## ✅ 总结

**成功简化了工作流程！**

- ❌ 移除了冗余的整体问题描述输入框
- ✅ 自动使用矩形框描述生成标题
- ✅ 自动使用矩形框描述生成详细说明
- ✅ 完全符合"一次输入，处处复用"的设计理念

**现在的流程更加简洁高效！** 🎉
